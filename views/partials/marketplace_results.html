<div class="marketplace-result-container">
    <div class="result-header">
        <span></span>
        <a class="sort">Description</a>
        <a class="sort">Année <i class="fa fa-caret-down" aria-hidden="true"></i></a>
        <a class="sort">Etat <i class="fa fa-caret-down" aria-hidden="true"></i></a>
        <a class="sort">Vendeur <i class="fa fa-caret-down" aria-hidden="true"></i></a>
        <a class="sort">Prix <i class="fa fa-caret-down" aria-hidden="true"></i></a>
    </div>
    <ul class="result-list">
        <li>
            <a class="link"><img src="images/1849a_1_franc_avers.png" alt/><img src="images/1849a_1_franc_revers.png" alt/></a>
            <div>
                <a class="link title">1 Franc Céres</a>
                <div><span>Métal :</span><span>Argent 900‰</span><span>Poids :</span><span>5 g</span></div>
                <div><span>Tranche :</span><span>Cannelée</span></div>
                <div><span>Graveur :</span><span>Eugène-André Oudiné</span></div>
            </div>
            <div><span class="year">1849 A</span></div>
            <div><span class="grade">SUP</span></div>
            <div>
                <a class="link seller">@michu</a>
                <div class="seller rating">
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <a class="link">150 notes</a>
                </div>
                <div><span>Expédié de :</span><span>Bordeaux</span></div>
            </div>
            <div>
                <span class="price">150 €</span>
                <span class="price">+ 2.5 €</span>
                <a class="button buy" title="Ajouter au panier"><i class="fa fa-cart-arrow-down" aria-hidden="true"></i></a>
            </div>
        </li>
        <li>
            <a class="link"><img src="images/1866k_1_franc_avers.png" alt/><img src="images/1866k_1_franc_revers.png" alt/></a>
            <div>
                <a class="link title">1 Franc Napoléon III tête laurée</a>
                <div><span>Métal :</span><span>Argent 835‰</span><span>Poids :</span><span>5 g</span></div>
                <div><span>Tranche :</span><span>Cannelée</span></div>
                <div><span>Graveur :</span><span>Désiré-Albert Barre</span></div>
            </div>
            <div><span class="year">1866 K</span></div>
            <div><span class="grade">SUP</span></div>
            <div>
                <a class="link seller">@pika</a>
                 <div class="seller rating">
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <a class="link">72 notes</a>
                </div>
                <div><span>Expédié de :</span><span>Marseille</span></div>
            </div>
            <div>
                <span class="price">200 €</span>
                <span class="price">gratuit</span>
                <a class="button buy" title="Ajouter au panier"><i class="fa fa-cart-arrow-down" aria-hidden="true"></i></a>
            </div>
        </li>
        <li>
            <a class="link"><img src="images/1898_2_franc_avers.png" alt/><img src="images/1898_2_franc_revers.png" alt/></a>
            <div>
                <a class="link title">2 Francs Semeuse</a>
                <div><span>Métal :</span><span>Argent 835‰</span><span>Poids :</span><span>10 g</span></div>
                <div><span>Tranche :</span><span>Cannelée</span></div>
                <div><span>Graveur :</span><span>Louis-Oscar Roty</span></div>
            </div>
            <div><span class="year">1898 FM</span></div>
            <div><span class="grade">SPL</span></div>
            <div>
                <a class="link seller">@pika</a>
                <div class="seller rating">
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <a class="link">72 notes</a>
                </div>
                <div><span>Expédié de :</span><span>Marseille</span></div>
            </div>
            <div>
                <span class="price">350 €</span>
                <span class="price">gratuit</span>
                <a class="button buy" title="Ajouter au panier"><i class="fa fa-cart-arrow-down" aria-hidden="true"></i></a>
            </div>
        </li>
        <li>
            <span><img src="images/1849a_1_franc_avers.png" alt/><img src="images/1849a_1_franc_revers.png" alt/></span>
            <div>
                <a class="link title">1 Franc Céres</a>
                <div><span>Métal :</span><span>Argent 900‰</span><span>Poids :</span><span>5 g</span></div>
                <div><span>Tranche :</span><span>Cannelée</span></div>
                <div><span>Graveur :</span><span>Eugène-André Oudiné</span></div>
            </div>
            <div><span class="year">1849 A</span></div>
            <div><span class="grade">SUP</span></div>
            <div>
                <a class="link seller">@michu</a>
                <div class="seller rating">
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <a class="link">150 notes</a>
                </div>
                <div><span>Expédié de :</span><span>Bordeaux</span></div>
            </div>
            <div>
                <span class="price">150 €</span>
                <a class="button buy" title="Ajouter au panier"><i class="fa fa-cart-arrow-down" aria-hidden="true"></i></a>
            </div>
        </li>
        <li>
            <a class="link"><img src="images/1866k_1_franc_avers.png" alt/><img src="images/1866k_1_franc_revers.png" alt/></a>
            <div>
                <a class="link title">1 Franc Napoléon III tête laurée</a>
                <div><span>Métal :</span><span>Argent 835‰</span><span>Poids :</span><span>5 g</span></div>
                <div><span>Tranche :</span><span>Cannelée</span></div>
                <div><span>Graveur :</span><span>Désiré-Albert Barre</span></div>
            </div>
            <div><span class="year">1866 K</span></div>
            <div><span class="grade">SUP</span></div>
            <div>
                <a class="link seller">@pika</a>
                 <div class="seller rating">
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <a class="link">72 notes</a>
                </div>
                <div><span>Expédié de :</span><span>Marseille</span></div>
            </div>
            <div>
                <span class="price">200 €</span>
                <a class="button buy" title="Ajouter au panier"><i class="fa fa-cart-arrow-down" aria-hidden="true"></i></a>
            </div>
        </li>
        <li>
            <span><img src="images/1898_2_franc_avers.png" alt/><img src="images/1898_2_franc_revers.png" alt/></span>
            <div>
                <a class="link title">2 Francs Semeuse</a>
                <div><span>Métal :</span><span>Argent 835‰</span><span>Poids :</span><span>10 g</span></div>
                <div><span>Tranche :</span><span>Cannelée</span></div>
                <div><span>Graveur :</span><span>Louis-Oscar Roty</span></div>
            </div>
            <div><span class="year">1898 FM</span></div>
            <div><span class="grade">SPL</span></div>
            <div>
                <a class="link seller">@pika</a>
                <div class="seller rating">
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <a class="link">72 notes</a>
                </div>
                <div><span>Expédié de :</span><span>Marseille</span></div>
            </div>
            <div>
                <span class="price">350 €</span>
                <a class="button buy" title="Ajouter au panier"><i class="fa fa-cart-arrow-down" aria-hidden="true"></i></a>
            </div>
        </li>
        <li>
            <span><img src="images/1849a_1_franc_avers.png" alt/><img src="images/1849a_1_franc_revers.png" alt/></span>
            <div>
                <a class="link title">1 Franc Céres</a>
                <div><span>Métal :</span><span>Argent 900‰</span><span>Poids :</span><span>5 g</span></div>
                <div><span>Tranche :</span><span>Cannelée</span></div>
                <div><span>Graveur :</span><span>Eugène-André Oudiné</span></div>
            </div>
            <div><span class="year">1849 A</span></div>
            <div><span class="grade">SUP</span></div>
            <div>
                <a class="link seller">@michu</a>
                <div class="seller rating">
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <a class="link">150 notes</a>
                </div>
                <div><span>Expédié de :</span><span>Bordeaux</span></div>
            </div>
            <div>
                <span class="price">150 €</span>
                <a class="button buy" title="Ajouter au panier"><i class="fa fa-cart-arrow-down" aria-hidden="true"></i></a>
            </div>
        </li>
        <li>
            <span><img src="images/1866k_1_franc_avers.png" alt/><img src="images/1866k_1_franc_revers.png" alt/></span>
            <div>
                <a class="link title">1 Franc Napoléon III tête laurée</a>
                <div><span>Métal :</span><span>Argent 835‰</span><span>Poids :</span><span>5 g</span></div>
                <div><span>Tranche :</span><span>Cannelée</span></div>
                <div><span>Graveur :</span><span>Désiré-Albert Barre</span></div>
            </div>
            <div><span class="year">1866 K</span></div>
            <div><span class="grade">SUP</span></div>
            <div>
                <a class="link seller">@pika</a>
                 <div class="seller rating">
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <a class="link">72 notes</a>
                </div>
                <div><span>Expédié de :</span><span>Marseille</span></div>
            </div>
            <div>
                <span class="price">200 €</span>
                <a class="button buy" title="Ajouter au panier"><i class="fa fa-cart-arrow-down" aria-hidden="true"></i></a>
            </div>
        </li>
        <li>
            <span><img src="images/1898_2_franc_avers.png" alt/><img src="images/1898_2_franc_revers.png" alt/></span>
            <div>
                <a class="link title">2 Francs Semeuse</a>
                <div><span>Métal :</span><span>Argent 835‰</span><span>Poids :</span><span>10 g</span></div>
                <div><span>Tranche :</span><span>Cannelée</span></div>
                <div><span>Graveur :</span><span>Louis-Oscar Roty</span></div>
            </div>
            <div><span class="year">1898 FM</span></div>
            <div><span class="grade">SPL</span></div>
            <div>
                <a class="link seller">@pika</a>
                <div class="seller rating">
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <a class="link">72 notes</a>
                </div>
                <div><span>Expédié de :</span><span>Marseille</span></div>
            </div>
            <div>
                <span class="price">350 €</span>
                <a class="button buy" title="Ajouter au panier"><i class="fa fa-cart-arrow-down" aria-hidden="true"></i></a>
            </div>
        </li>
    </ul>
</div>

<script type="text/javascript">

    function syncNavHeaderAndList() {
        var container = document.querySelector('.marketplace-result-container .result-list');
        //var containerStyle = container.currentStyle || window.getComputedStyle(container);
        
        var nav = document.querySelector('.page-nav');
        var header = document.querySelector('.marketplace-result-container .result-header');

        nav.style.width = container.offsetWidth + 'px';
        header.style.width = container.offsetWidth + 'px';
    }

    window.addEventListener('resize', syncNavHeaderAndList);

    syncNavHeaderAndList();

    /*
    var mrc= {
        previousResultPage: function() {
            this.pageIndex--;
            if(this.pageIndex == 0) this.pageIndex = 1;

            this.gatherResults('http://localhost:8080/search/results_' + this.pageIndex + '.json');
        },

        nextResultPage: function() {
            this.pageIndex++;
            if(this.pageIndex == this.pageCount) this.pageIndex = this.pageCount;

            this.gatherResults('http://localhost:8080/search/results_' + this.pageIndex + '.json');
        },

        pickResultHandler: function(evt) {
            var item = (evt.target || evt.srcElement);
            
            while(item != null && item.tagName != 'LI') item = item.parentNode;
            if(item == null) return;

            //console.log(item.itemInfo);
            var self = this;

            // show loading progress
            self.loadingNode.classList.add('show');

            // TODO: remove setTimeout later (here for demo purpose only)
            window.setTimeout(function() {
                window.location.href = "item.html";
            },
            1000);
        },

        clearResults: function(){
            if(!this.listNode) return;

            Array.from(this.listNode.querySelectorAll('li')).forEach(function(li){
                li.itemInfo = null;
                li.querySelector('a').removeEventListener('click', this.pickResultProxy);

                this.listNode.removeChild(li);
            }, this);
        },

        gatherResults : function(url) {
            var self = this;

            // show loading progress
            self.loadingNode.classList.add('show');

            // TODO: remove setTimeout later (here for demo purpose only)
            window.setTimeout(function() {

                Ajax.getJSON(url, false).then(function(data) {
                    if(data) {
                        // clear previous results
                        self.clearResults();
                        
                        // update nav bar
                        self.pageIndex = data.page_index;
                        self.pageCount = data.page_count;

                        var navCountItem = self.navNode.querySelector('span:nth-of-type(1)');
                        if(navCountItem) navCountItem.innerHTML = `${data.page_index} - ${data.page_count}`;

                        var navPreviousLink = self.navNode.querySelector('a:nth-of-type(1)');
                        if(navPreviousLink){
                            if(self.pageIndex <= 1) navPreviousLink.classList.add('disabled');
                            else navPreviousLink.classList.remove('disabled');
                        }

                        var navNextLink = self.navNode.querySelector('a:nth-of-type(2)');                        
                        if(navNextLink) {
                            if(self.pageIndex == self.pageCount) navNextLink.classList.add('disabled');
                            else navNextLink.classList.remove('disabled');
                        }

                        // append results
                        (data.results || []).forEach(function(resultInfo) {
                            var title = `${resultInfo.desc} ${resultInfo.date || ''} ${resultInfo.letter || ''}`.trim();
                            var engraver = `${resultInfo.engraver}`.trim();

                            var newResultNode = document.createElement('li');
                            newResultNode.innerHTML = `<a title="${title}"><figure><figcaption><span class="title">${title}</span><span class="engraver">${engraver}</span></figcaption><img src='${resultInfo.obverse}' alt/><img src='${resultInfo.reverse}' alt/><span class='grade'>${resultInfo.grade}</span></figure></a>`;
                            newResultNode.itemInfo = resultInfo;

                            self.listNode.appendChild(newResultNode);

                            newResultNode.querySelector('a').addEventListener('click', self.pickResultProxy);
                        });

                        // hide progress
                        self.loadingNode.classList.remove('show');
                    }
                }, function() {
                    // hide progress
                    self.loadingNode.classList.remove('show');
                });

            }, 1000);
        },

        registerHandlers: function() {
            if(!this.previousResultPageProxy) {
                var self = this;
                this.previousResultPageProxy = function() { self.previousResultPage.apply(self, [...arguments]); }
                this.nextResultPageProxy = function() { self.nextResultPage.apply(self, [...arguments]); }
                this.pickResultProxy = function() { self.pickResultHandler.apply(self, [...arguments]); }
            }

            var navPreviousLink = this.navNode.querySelector('a:nth-of-type(1)');
            var navNextLink = this.navNode.querySelector('a:nth-of-type(2)');
            if(navPreviousLink) navPreviousLink.addEventListener('click', this.previousResultPageProxy);
            if(navNextLink) navNextLink.addEventListener('click', this.nextResultPageProxy);
        },

        unregisterHandlers: function() {

            var navPreviousLink = this.navNode.querySelector('a:nth-of-type(1)');
            var navNextLink = this.navNode.querySelector('a:nth-of-type(2)');
            if(navPreviousLink) navPreviousLink.removeEventListener('click', this.previousResultPageProxy);
            if(navNextLink) navNextLink.removeEventListener('click', this.nextResultPageProxy);
        },

        init: function() {
            this.pageIndex = 0;
            this.pageCount = 0;
            this.sortType = 'LastAdds';

            this.node = document.querySelector('.search-result-container');
            this.navNode = document.querySelector('.page-nav .nav-bar');
            this.listNode = this.node.querySelector('ul');

            // import/create the loading frame
            var template = document.querySelector('#loading-template').import.querySelector('template');
            var content = document.importNode(template.content, true);
            this.node.appendChild(content);

            this.loadingNode = this.node.querySelector('.loading-overlay');

            this.registerHandlers();
            this.gatherResults('http://localhost:8080/search/results_1.json');
        }
    };

    mrc.init();
    */
</script>